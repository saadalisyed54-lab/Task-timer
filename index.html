<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Timer App - Offline First</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ============================================
           DESIGN PHILOSOPHY: Minimalist Zen
           - Extreme whitespace and clarity
           - Soft sage green accents (#8B9D7F)
           - Smooth, subtle animations (300ms ease-out)
           - Large, readable typography
           ============================================ */

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Color Palette */
            --color-white: #FFFFFF;
            --color-charcoal: #1A1A1A;
            --color-light-gray: #F5F5F5;
            --color-medium-gray: #E0E0E0;
            --color-dark-gray: #333333;
            --color-sage: #8B9D7F;
            --color-sage-light: #A8B89A;
            --color-sage-dark: #6B7D5F;
            --color-accent: #8B9D7F;
            --color-success: #4CAF50;
            --color-warning: #FF9800;
            --color-danger: #F44336;
            --color-info: #2196F3;
            
            /* Theme Variables */
            --bg-primary: #FFFFFF;
            --bg-secondary: #F5F5F5;
            --text-primary: #1A1A1A;
            --text-secondary: #666666;
            --border-color: #E0E0E0;
            
            /* Spacing */
            --spacing-xs: 0.5rem;
            --spacing-sm: 1rem;
            --spacing-md: 1.5rem;
            --spacing-lg: 2rem;
            --spacing-xl: 3rem;
            
            /* Typography */
            --font-display: 'Playfair Display', serif;
            --font-body: 'Inter', sans-serif;
            --font-size-timer: 3.5rem;
            --font-size-heading: 1.75rem;
            --font-size-body: 1rem;
            --font-size-small: 0.875rem;
            
            /* Transitions */
            --transition-smooth: all 300ms ease-out;
            --transition-fast: all 200ms ease-out;
        }

        /* ============ THEME DEFINITIONS ============ */
        
        /* Theme 1: Pure White */
        body.theme-pure-white {
            --bg-primary: #FFFFFF;
            --bg-secondary: #F9F9F9;
            --text-primary: #1A1A1A;
            --text-secondary: #666666;
            --border-color: #E8E8E8;
        }

        /* Theme 2: Deep Dark */
        body.theme-deep-dark {
            --bg-primary: #0F0F0F;
            --bg-secondary: #1A1A1A;
            --text-primary: #FFFFFF;
            --text-secondary: #CCCCCC;
            --border-color: #333333;
        }

        /* Theme 3: Soft Gray */
        body.theme-soft-gray {
            --bg-primary: #F0F0F0;
            --bg-secondary: #E8E8E8;
            --text-primary: #2C2C2C;
            --text-secondary: #666666;
            --border-color: #D0D0D0;
        }

        /* Theme 4: Ocean Blue */
        body.theme-ocean-blue {
            --bg-primary: #E3F2FD;
            --bg-secondary: #BBDEFB;
            --text-primary: #0D47A1;
            --text-secondary: #1565C0;
            --border-color: #90CAF9;
        }

        /* Theme 5: Forest Green */
        body.theme-forest-green {
            --bg-primary: #E8F5E9;
            --bg-secondary: #C8E6C9;
            --text-primary: #1B5E20;
            --text-secondary: #2E7D32;
            --border-color: #A5D6A7;
        }

        /* Theme 6: Sunset Orange */
        body.theme-sunset-orange {
            --bg-primary: #FFE0B2;
            --bg-secondary: #FFCC80;
            --text-primary: #E65100;
            --text-secondary: #F57C00;
            --border-color: #FFB74D;
        }

        /* Theme 7: Purple Dream */
        body.theme-purple-dream {
            --bg-primary: #F3E5F5;
            --bg-secondary: #E1BEE7;
            --text-primary: #4A148C;
            --text-secondary: #6A1B9A;
            --border-color: #CE93D8;
        }

        /* Theme 8: Rose Pink */
        body.theme-rose-pink {
            --bg-primary: #FCE4EC;
            --bg-secondary: #F8BBD0;
            --text-primary: #880E4F;
            --text-secondary: #C2185B;
            --border-color: #F48FB1;
        }

        /* Theme 9: Teal Breeze */
        body.theme-teal-breeze {
            --bg-primary: #E0F2F1;
            --bg-secondary: #B2DFDB;
            --text-primary: #004D40;
            --text-secondary: #00695C;
            --border-color: #80CBC4;
        }

        /* Theme 10: Amber Glow */
        body.theme-amber-glow {
            --bg-primary: #FFF8E1;
            --bg-secondary: #FFECB3;
            --text-primary: #F57F17;
            --text-secondary: #F9A825;
            --border-color: #FFD54F;
        }

        /* Theme 11: Midnight Blue */
        body.theme-midnight-blue {
            --bg-primary: #1A237E;
            --bg-secondary: #283593;
            --text-primary: #E8EAFF;
            --text-secondary: #C5CAE9;
            --border-color: #3F51B5;
        }

        /* Theme 12: Charcoal Noir */
        body.theme-charcoal-noir {
            --bg-primary: #212121;
            --bg-secondary: #424242;
            --text-primary: #F5F5F5;
            --text-secondary: #BDBDBD;
            --border-color: #616161;
        }

        /* Theme 13: Mint Fresh */
        body.theme-mint-fresh {
            --bg-primary: #E0F2F1;
            --bg-secondary: #B2DFDB;
            --text-primary: #00695C;
            --text-secondary: #00897B;
            --border-color: #80CBC4;
        }

        /* Theme 14: Coral Reef */
        body.theme-coral-reef {
            --bg-primary: #FFEBEE;
            --bg-secondary: #FFCDD2;
            --text-primary: #B71C1C;
            --text-secondary: #D32F2F;
            --border-color: #EF9A9A;
        }

        /* Theme 15: Lavender Mist */
        body.theme-lavender-mist {
            --bg-primary: #F3E5F5;
            --bg-secondary: #E1BEE7;
            --text-primary: #512DA8;
            --text-secondary: #7B1FA2;
            --border-color: #CE93D8;
        }

        /* Theme 16: Slate Gray */
        body.theme-slate-gray {
            --bg-primary: #ECEFF1;
            --bg-secondary: #CFD8DC;
            --text-primary: #263238;
            --text-secondary: #455A64;
            --border-color: #B0BEC5;
        }

        /* Theme 17: Indigo Night */
        body.theme-indigo-night {
            --bg-primary: #1A1A2E;
            --bg-secondary: #16213E;
            --text-primary: #E0E0E0;
            --text-secondary: #B0B0B0;
            --border-color: #0F3460;
        }

        /* Theme 18: Peach Cream */
        body.theme-peach-cream {
            --bg-primary: #FFF3E0;
            --bg-secondary: #FFE0B2;
            --text-primary: #E65100;
            --text-secondary: #F57C00;
            --border-color: #FFCC80;
        }

        /* Theme 19: Sage Serenity */
        body.theme-sage-serenity {
            --bg-primary: #F1F5F3;
            --bg-secondary: #E0E8E5;
            --text-primary: #2D5016;
            --text-secondary: #4A7023;
            --border-color: #C5D9C1;
        }

        /* Theme 20: Graphite Steel */
        body.theme-graphite-steel {
            --bg-primary: #37474F;
            --bg-secondary: #455A64;
            --text-primary: #ECEFF1;
            --text-secondary: #CFD8DC;
            --border-color: #607D8B;
        }

        body {
            font-family: var(--font-body);
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: var(--transition-smooth);
            min-height: 100vh;
            padding: var(--spacing-md);
        }

        /* ============ LAYOUT ============ */

        .container {
            max-width: 600px;
            margin: 0 auto;
            width: 100%;
        }

        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-xl);
            padding-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--border-color);
        }

        .app-title {
            font-family: var(--font-display);
            font-size: var(--font-size-heading);
            color: var(--text-primary);
            font-weight: 700;
        }

        .theme-selector {
            position: relative;
        }

        .theme-button {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 50%;
            width: 44px;
            height: 44px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            transition: var(--transition-fast);
        }

        .theme-button:hover {
            background: var(--color-sage);
            color: white;
            border-color: var(--color-sage);
        }

        .theme-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--bg-primary);
            border: 2px solid var(--color-sage);
            border-radius: 8px;
            margin-top: var(--spacing-sm);
            display: none;
            flex-direction: column;
            z-index: 1000;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
            max-height: 400px;
            overflow-y: auto;
        }

        .theme-dropdown.active {
            display: flex;
        }

        .theme-option {
            padding: var(--spacing-sm) var(--spacing-md);
            cursor: pointer;
            transition: var(--transition-fast);
            border: none;
            background: none;
            text-align: left;
            color: var(--text-primary);
            font-family: var(--font-body);
            font-size: var(--font-size-body);
        }

        .theme-option:hover {
            background: var(--bg-secondary);
            padding-left: calc(var(--spacing-md) + var(--spacing-xs));
        }

        .navigation {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-lg);
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-button {
            padding: var(--spacing-xs) var(--spacing-md);
            border: 2px solid var(--border-color);
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-radius: 6px;
            cursor: pointer;
            font-family: var(--font-body);
            font-size: var(--font-size-small);
            font-weight: 500;
            transition: var(--transition-fast);
        }

        .nav-button:hover,
        .nav-button.active {
            background: var(--color-sage);
            color: white;
            border-color: var(--color-sage);
        }

        .page {
            display: none;
            animation: fadeIn 300ms ease-out;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.98);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* ============ FORMS ============ */

        .form-group {
            margin-bottom: var(--spacing-md);
        }

        .form-label {
            display: block;
            margin-bottom: var(--spacing-xs);
            font-weight: 600;
            font-size: var(--font-size-small);
            color: var(--text-primary);
        }

        .form-input {
            width: 100%;
            padding: var(--spacing-sm);
            border: 2px solid var(--border-color);
            border-radius: 6px;
            font-family: var(--font-body);
            font-size: var(--font-size-body);
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: var(--transition-fast);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--color-sage);
            box-shadow: 0 0 0 3px rgba(139, 157, 127, 0.1);
        }

        .form-input::placeholder {
            color: var(--text-secondary);
        }

        .button {
            padding: var(--spacing-sm) var(--spacing-md);
            border: none;
            border-radius: 6px;
            font-family: var(--font-body);
            font-size: var(--font-size-body);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-fast);
            display: inline-block;
        }

        .button-primary {
            background: var(--color-sage);
            color: white;
        }

        .button-primary:hover {
            background: var(--color-sage-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 157, 127, 0.3);
        }

        .button-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
        }

        .button-secondary:hover {
            background: var(--border-color);
        }

        .button-danger {
            background: var(--color-danger);
            color: white;
        }

        .button-danger:hover {
            background: #D32F2F;
        }

        .button-success {
            background: var(--color-success);
            color: white;
        }

        .button-success:hover {
            background: #388E3C;
        }

        .button-small {
            padding: var(--spacing-xs) var(--spacing-sm);
            font-size: var(--font-size-small);
        }

        .button-group {
            display: flex;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
            margin-top: var(--spacing-md);
        }

        /* ============ CARDS ============ */

        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
            transition: var(--transition-smooth);
        }

        .card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .card-title {
            font-family: var(--font-display);
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: var(--spacing-md);
            color: var(--text-primary);
        }

        .card-subtitle {
            font-size: var(--font-size-small);
            color: var(--text-secondary);
            margin-bottom: var(--spacing-sm);
        }

        /* ============ TIMER DISPLAY ============ */

        .timer-display {
            font-family: var(--font-display);
            font-size: var(--font-size-timer);
            font-weight: 700;
            text-align: center;
            margin: var(--spacing-lg) 0;
            color: var(--color-sage);
            letter-spacing: -2px;
            animation: timerPulse 2s ease-in-out infinite;
        }

        @keyframes timerPulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.85;
            }
        }

        .timer-display.completed {
            color: var(--color-success);
            animation: timerBounce 0.6s ease-out;
        }

        @keyframes timerBounce {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
            margin: var(--spacing-md) 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--color-sage), var(--color-sage-light));
            border-radius: 4px;
            transition: width 100ms linear;
        }

        /* ============ TASK ITEMS ============ */

        .task-item {
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            transition: var(--transition-smooth);
        }

        .task-item:hover {
            border-color: var(--color-sage);
            box-shadow: 0 4px 12px rgba(139, 157, 127, 0.15);
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--spacing-md);
        }

        .task-name {
            font-weight: 600;
            font-size: var(--font-size-body);
            color: var(--text-primary);
            flex: 1;
            word-break: break-word;
        }

        .task-status {
            background: var(--color-sage);
            color: white;
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: 4px;
            font-size: var(--font-size-small);
            font-weight: 600;
            white-space: nowrap;
            margin-left: var(--spacing-sm);
        }

        .task-status.completed {
            background: var(--color-success);
        }

        .task-status.failed {
            background: var(--color-danger);
        }

        .task-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
            font-size: var(--font-size-small);
            color: var(--text-secondary);
        }

        .task-info-item {
            display: flex;
            justify-content: space-between;
        }

        .task-controls {
            display: flex;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
        }

        /* ============ EMPTY STATE ============ */

        .empty-state {
            text-align: center;
            padding: var(--spacing-xl);
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: var(--spacing-md);
        }

        .empty-state-text {
            font-size: var(--font-size-body);
        }

        /* ============ MODAL ============ */

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 300ms ease-out;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-primary);
            border-radius: 12px;
            padding: var(--spacing-xl);
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 300ms ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-title {
            font-family: var(--font-display);
            font-size: var(--font-size-heading);
            margin-bottom: var(--spacing-md);
            color: var(--text-primary);
        }

        .modal-text {
            color: var(--text-secondary);
            margin-bottom: var(--spacing-lg);
            font-size: var(--font-size-body);
        }

        .modal-buttons {
            display: flex;
            gap: var(--spacing-md);
            justify-content: center;
        }

        /* ============ STATS ============ */

        .stats-section {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
            text-align: center;
        }

        .stat-label {
            font-size: var(--font-size-small);
            color: var(--text-secondary);
            margin-bottom: var(--spacing-xs);
        }

        .stat-value {
            font-family: var(--font-display);
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--color-sage);
        }

        /* ============ ACTIVITY LOG ============ */

        .activity-item {
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-text {
            font-size: var(--font-size-body);
            color: var(--text-primary);
        }

        .activity-time {
            font-size: var(--font-size-small);
            color: var(--text-secondary);
            white-space: nowrap;
            margin-left: var(--spacing-md);
        }

        /* ============ RESPONSIVE ============ */

        @media (max-width: 640px) {
            :root {
                --font-size-timer: 2.5rem;
                --font-size-heading: 1.5rem;
                --spacing-lg: 1.5rem;
            }

            .app-header {
                flex-direction: column;
                gap: var(--spacing-md);
                align-items: flex-start;
            }

            .theme-selector {
                align-self: flex-start;
            }

            .navigation {
                gap: var(--spacing-xs);
            }

            .nav-button {
                padding: var(--spacing-xs) var(--spacing-sm);
                font-size: var(--font-size-small);
            }

            .task-info {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 95%;
            }

            .container {
                padding: 0;
            }

            body {
                padding: var(--spacing-sm);
            }
        }

        /* ============ UTILITY ============ */

        .text-center {
            text-align: center;
        }

        .mt-md {
            margin-top: var(--spacing-md);
        }

        .mb-md {
            margin-bottom: var(--spacing-md);
        }

        .hidden {
            display: none;
        }

        .fire-effect {
            display: inline-block;
            animation: fireFlicker 0.5s infinite;
        }

        @keyframes fireFlicker {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.7;
                transform: scale(1.1);
            }
        }
    </style>
</head>
<body class="theme-pure-white">
    <div class="container">
        <!-- Header -->
        <div class="app-header">
            <h1 class="app-title">‚è±Ô∏è Task Timer</h1>
            <div class="theme-selector">
                <button class="theme-button" id="themeBtn" title="Change Theme">üé®</button>
                <div class="theme-dropdown" id="themeDropdown">
                    <button class="theme-option" data-theme="theme-pure-white">Pure White</button>
                    <button class="theme-option" data-theme="theme-deep-dark">Deep Dark</button>
                    <button class="theme-option" data-theme="theme-soft-gray">Soft Gray</button>
                    <button class="theme-option" data-theme="theme-ocean-blue">Ocean Blue</button>
                    <button class="theme-option" data-theme="theme-forest-green">Forest Green</button>
                    <button class="theme-option" data-theme="theme-sunset-orange">Sunset Orange</button>
                    <button class="theme-option" data-theme="theme-purple-dream">Purple Dream</button>
                    <button class="theme-option" data-theme="theme-rose-pink">Rose Pink</button>
                    <button class="theme-option" data-theme="theme-teal-breeze">Teal Breeze</button>
                    <button class="theme-option" data-theme="theme-amber-glow">Amber Glow</button>
                    <button class="theme-option" data-theme="theme-midnight-blue">Midnight Blue</button>
                    <button class="theme-option" data-theme="theme-charcoal-noir">Charcoal Noir</button>
                    <button class="theme-option" data-theme="theme-mint-fresh">Mint Fresh</button>
                    <button class="theme-option" data-theme="theme-coral-reef">Coral Reef</button>
                    <button class="theme-option" data-theme="theme-lavender-mist">Lavender Mist</button>
                    <button class="theme-option" data-theme="theme-slate-gray">Slate Gray</button>
                    <button class="theme-option" data-theme="theme-indigo-night">Indigo Night</button>
                    <button class="theme-option" data-theme="theme-peach-cream">Peach Cream</button>
                    <button class="theme-option" data-theme="theme-sage-serenity">Sage Serenity</button>
                    <button class="theme-option" data-theme="theme-graphite-steel">Graphite Steel</button>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="navigation">
            <button class="nav-button active" data-page="running">Running</button>
            <button class="nav-button" data-page="paused">Paused</button>
            <button class="nav-button" data-page="completed">Completed</button>
            <button class="nav-button" data-page="not-completed">Not Completed</button>
            <button class="nav-button" data-page="library">Library</button>
            <button class="nav-button" data-page="activity">Activity</button>
        </div>

        <!-- Running Tasks Page -->
        <div class="page active" id="running-page">
            <div class="card">
                <h2 class="card-title">Create New Task</h2>
                <form id="taskForm">
                    <div class="form-group">
                        <label class="form-label">Task Name</label>
                        <input type="text" class="form-input" id="taskName" placeholder="Enter task name" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Total Time (minutes)</label>
                        <input type="number" class="form-input" id="taskTime" placeholder="Enter time in minutes" min="1" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Reward Tokens</label>
                        <input type="number" class="form-input" id="taskReward" placeholder="Enter reward tokens" min="0" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Penalty Tokens</label>
                        <input type="number" class="form-input" id="taskPenalty" placeholder="Enter penalty tokens" min="0" required>
                    </div>
                    <button type="submit" class="button button-primary" style="width: 100%;">Start Task</button>
                </form>
            </div>

            <div id="runningTasks"></div>

            <div class="button-group" style="justify-content: center; margin-top: var(--spacing-lg);">
                <button class="button button-secondary" id="resetRunningBtn">Reset Running</button>
                <button class="button button-danger" id="masterResetBtn">Master Reset</button>
            </div>
        </div>

        <!-- Paused Tasks Page -->
        <div class="page" id="paused-page">
            <div id="pausedTasks"></div>
            <div class="button-group" style="justify-content: center; margin-top: var(--spacing-lg);">
                <button class="button button-secondary" id="resetPausedBtn">Reset Paused</button>
            </div>
        </div>

        <!-- Completed Tasks Page -->
        <div class="page" id="completed-page">
            <div id="completedTasks"></div>
            <div class="button-group" style="justify-content: center; margin-top: var(--spacing-lg);">
                <button class="button button-secondary" id="resetCompletedBtn">Reset Completed</button>
            </div>
        </div>

        <!-- Not Completed Tasks Page -->
        <div class="page" id="not-completed-page">
            <div id="notCompletedTasks"></div>
            <div class="button-group" style="justify-content: center; margin-top: var(--spacing-lg);">
                <button class="button button-secondary" id="resetNotCompletedBtn">Reset Not Completed</button>
            </div>
        </div>

        <!-- Permanent Task Library -->
        <div class="page" id="library-page">
            <div class="card">
                <h2 class="card-title">Permanent Task Library</h2>
                <p class="card-subtitle">Create reusable tasks that persist permanently</p>
                <form id="libraryForm">
                    <div class="form-group">
                        <label class="form-label">Task Name</label>
                        <input type="text" class="form-input" id="libTaskName" placeholder="Enter task name" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Total Time (minutes)</label>
                        <input type="number" class="form-input" id="libTaskTime" placeholder="Enter time in minutes" min="1" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Reward Tokens</label>
                        <input type="number" class="form-input" id="libTaskReward" placeholder="Enter reward tokens" min="0" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Penalty Tokens</label>
                        <input type="number" class="form-input" id="libTaskPenalty" placeholder="Enter penalty tokens" min="0" required>
                    </div>
                    <button type="submit" class="button button-primary" style="width: 100%;">Add to Library</button>
                </form>
            </div>

            <div class="card">
                <h2 class="card-title">Library Tasks</h2>
                <div class="button-group" style="margin-bottom: var(--spacing-md);">
                    <button class="button button-secondary" id="toggleControlsBtn">Show All Task Controls</button>
                    <button class="button button-secondary" id="resetLibraryBtn">Reset Library</button>
                </div>
                <div id="libraryTasks"></div>
            </div>
        </div>

        <!-- Activity Log Page -->
        <div class="page" id="activity-page">
            <div class="card">
                <h2 class="card-title">Token Management</h2>
                <div class="stats-section">
                    <div class="stat-label">Total Tokens</div>
                    <div class="stat-value" id="tokenDisplay">0</div>
                </div>
                <form id="tokenForm">
                    <div class="form-group">
                        <label class="form-label">Add/Subtract Tokens</label>
                        <input type="number" class="form-input" id="tokenInput" placeholder="Enter amount (positive or negative)">
                    </div>
                    <button type="submit" class="button button-primary" style="width: 100%;">Update Tokens</button>
                </form>
                <button class="button button-danger" id="resetTokensBtn" style="width: 100%; margin-top: var(--spacing-md);">Reset Tokens</button>
            </div>

            <div class="card">
                <h2 class="card-title">Activity Log (Latest 10)</h2>
                <div id="activityLog"></div>
            </div>
        </div>
    </div>

    <!-- Completion Modal -->
    <div class="modal" id="completionModal">
        <div class="modal-content">
            <h2 class="modal-title">Task Complete!</h2>
            <p class="modal-text" id="completionTaskName"></p>
            <p class="modal-text">Did you complete this task?</p>
            <div class="modal-buttons">
                <button class="button button-success" id="completedBtn">‚úÖ Completed</button>
                <button class="button button-danger" id="notCompletedBtn">‚ùå Not Completed</button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // TASK TIMER APP - COMPLETE OFFLINE-FIRST APP
        // ============================================

        class TaskTimerApp {
            constructor() {
                this.tasks = {
                    running: [],
                    paused: [],
                    completed: [],
                    notCompleted: [],
                    library: []
                };
                this.tokens = 0;
                this.activities = [];
                this.currentPage = 'running';
                this.showAllLibraryControls = false;
                this.completingTaskId = null;

                this.loadFromStorage();
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.render();
                this.startTimerLoop();
            }

            setupEventListeners() {
                // Theme selector
                document.getElementById('themeBtn').addEventListener('click', () => {
                    const dropdown = document.getElementById('themeDropdown');
                    dropdown.classList.toggle('active');
                });

                document.querySelectorAll('.theme-option').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const theme = e.target.dataset.theme;
                        this.setTheme(theme);
                        document.getElementById('themeDropdown').classList.remove('active');
                    });
                });

                // Navigation
                document.querySelectorAll('.nav-button').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.nav-button').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.currentPage = e.target.dataset.page;
                        this.showPage(this.currentPage);
                    });
                });

                // Task form
                document.getElementById('taskForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.createTask();
                });

                // Library form
                document.getElementById('libraryForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addLibraryTask();
                });

                // Token form
                document.getElementById('tokenForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.updateTokens();
                });

                // Reset buttons
                document.getElementById('resetRunningBtn').addEventListener('click', () => this.resetPage('running'));
                document.getElementById('resetPausedBtn').addEventListener('click', () => this.resetPage('paused'));
                document.getElementById('resetCompletedBtn').addEventListener('click', () => this.resetPage('completed'));
                document.getElementById('resetNotCompletedBtn').addEventListener('click', () => this.resetPage('notCompleted'));
                document.getElementById('masterResetBtn').addEventListener('click', () => this.masterReset());
                document.getElementById('resetTokensBtn').addEventListener('click', () => this.resetTokens());
                document.getElementById('resetLibraryBtn').addEventListener('click', () => this.resetLibrary());
                document.getElementById('toggleControlsBtn').addEventListener('click', () => this.toggleLibraryControls());

                // Modal buttons
                document.getElementById('completedBtn').addEventListener('click', () => this.completeTask(true));
                document.getElementById('notCompletedBtn').addEventListener('click', () => this.completeTask(false));

                // Close modal on background click
                document.getElementById('completionModal').addEventListener('click', (e) => {
                    if (e.target.id === 'completionModal') {
                        this.closeModal();
                    }
                });
            }

            createTask() {
                const name = document.getElementById('taskName').value;
                const time = parseInt(document.getElementById('taskTime').value);
                const reward = parseInt(document.getElementById('taskReward').value);
                const penalty = parseInt(document.getElementById('taskPenalty').value);

                if (!name || !time || reward === undefined || penalty === undefined) return;

                const task = {
                    id: Date.now(),
                    name,
                    totalTime: time * 60 * 1000,
                    reward,
                    penalty,
                    startTime: Date.now(),
                    pausedTime: 0,
                    isPaused: false
                };

                this.tasks.running.push(task);
                this.logActivity(`Task started: ${name}`);
                this.saveToStorage();
                this.render();

                // Clear form
                document.getElementById('taskForm').reset();
            }

            addLibraryTask() {
                const name = document.getElementById('libTaskName').value;
                const time = parseInt(document.getElementById('libTaskTime').value);
                const reward = parseInt(document.getElementById('libTaskReward').value);
                const penalty = parseInt(document.getElementById('libTaskPenalty').value);

                if (!name || !time || reward === undefined || penalty === undefined) return;

                const task = {
                    id: Date.now(),
                    name,
                    totalTime: time * 60 * 1000,
                    reward,
                    penalty,
                    status: 'ready' // ready, running, paused, completed, failed
                };

                this.tasks.library.push(task);
                this.saveToStorage();
                this.render();

                document.getElementById('libraryForm').reset();
            }

            startLibraryTask(taskId) {
                const libTask = this.tasks.library.find(t => t.id === taskId);
                if (!libTask || libTask.status !== 'ready') return;

                const task = {
                    id: Date.now(),
                    name: libTask.name,
                    totalTime: libTask.totalTime,
                    reward: libTask.reward,
                    penalty: libTask.penalty,
                    startTime: Date.now(),
                    pausedTime: 0,
                    isPaused: false,
                    libraryId: taskId
                };

                this.tasks.running.push(task);
                libTask.status = 'running';
                this.logActivity(`Task started from library: ${libTask.name}`);
                this.saveToStorage();
                this.render();
            }

            pauseTask(taskId) {
                const task = this.tasks.running.find(t => t.id === taskId);
                if (!task) return;

                task.isPaused = true;
                task.pausedTime = Date.now();

                this.tasks.paused.push(task);
                this.tasks.running = this.tasks.running.filter(t => t.id !== taskId);

                if (task.libraryId) {
                    const libTask = this.tasks.library.find(t => t.id === task.libraryId);
                    if (libTask) libTask.status = 'paused';
                }

                this.logActivity(`Task paused: ${task.name}`);
                this.saveToStorage();
                this.render();
            }

            resumeTask(taskId) {
                const task = this.tasks.paused.find(t => t.id === taskId);
                if (!task) return;

                const pausedDuration = Date.now() - task.pausedTime;
                task.startTime += pausedDuration;
                task.isPaused = false;
                task.pausedTime = 0;

                this.tasks.running.push(task);
                this.tasks.paused = this.tasks.paused.filter(t => t.id !== taskId);

                if (task.libraryId) {
                    const libTask = this.tasks.library.find(t => t.id === task.libraryId);
                    if (libTask) libTask.status = 'running';
                }

                this.logActivity(`Task resumed: ${task.name}`);
                this.saveToStorage();
                this.render();
            }

            showCompletionModal(taskId) {
                this.completingTaskId = taskId;
                const task = this.tasks.running.find(t => t.id === taskId);
                if (task) {
                    document.getElementById('completionTaskName').textContent = task.name;
                    document.getElementById('completionModal').classList.add('active');
                }
            }

            closeModal() {
                document.getElementById('completionModal').classList.remove('active');
                this.completingTaskId = null;
            }

            completeTask(isCompleted) {
                const task = this.tasks.running.find(t => t.id === this.completingTaskId);
                if (!task) return;

                this.tasks.running = this.tasks.running.filter(t => t.id !== this.completingTaskId);

                if (isCompleted) {
                    this.tasks.completed.push(task);
                    this.tokens += task.reward;
                    this.logActivity(`Task completed: ${task.name} (+${task.reward} tokens)`);

                    if (task.libraryId) {
                        const libTask = this.tasks.library.find(t => t.id === task.libraryId);
                        if (libTask) libTask.status = 'ready';
                    }
                } else {
                    this.tasks.notCompleted.push(task);
                    this.tokens -= task.penalty;
                    this.logActivity(`Task failed: ${task.name} (-${task.penalty} tokens)`);

                    if (task.libraryId) {
                        const libTask = this.tasks.library.find(t => t.id === task.libraryId);
                        if (libTask) libTask.status = 'ready';
                    }
                }

                this.closeModal();
                this.saveToStorage();
                this.render();
            }

            deleteLibraryTask(taskId) {
                this.tasks.library = this.tasks.library.filter(t => t.id !== taskId);
                this.saveToStorage();
                this.render();
            }

            resetPage(page) {
                if (page === 'running') {
                    this.tasks.running = [];
                } else if (page === 'paused') {
                    this.tasks.paused = [];
                } else if (page === 'completed') {
                    this.tasks.completed = [];
                } else if (page === 'notCompleted') {
                    this.tasks.notCompleted = [];
                }
                this.logActivity(`Reset ${page} tasks`);
                this.saveToStorage();
                this.render();
            }

            resetLibrary() {
                this.tasks.library.forEach(t => t.status = 'ready');
                this.logActivity('Reset library tasks');
                this.saveToStorage();
                this.render();
            }

            masterReset() {
                if (confirm('Are you sure you want to reset everything? This cannot be undone.')) {
                    this.tasks = {
                        running: [],
                        paused: [],
                        completed: [],
                        notCompleted: [],
                        library: []
                    };
                    this.tokens = 0;
                    this.activities = [];
                    this.logActivity('Master reset performed');
                    this.saveToStorage();
                    this.render();
                }
            }

            updateTokens() {
                const amount = parseInt(document.getElementById('tokenInput').value);
                if (isNaN(amount)) return;

                this.tokens += amount;
                this.logActivity(`Tokens manually adjusted: ${amount > 0 ? '+' : ''}${amount}`);
                this.saveToStorage();
                this.render();

                document.getElementById('tokenForm').reset();
            }

            resetTokens() {
                this.tokens = 0;
                this.logActivity('Tokens reset to 0');
                this.saveToStorage();
                this.render();
            }

            toggleLibraryControls() {
                this.showAllLibraryControls = !this.showAllLibraryControls;
                this.render();
            }

            logActivity(text) {
                const now = new Date();
                const timeStr = this.formatPakistaniTime(now);

                this.activities.unshift({
                    text,
                    time: timeStr,
                    timestamp: now.getTime()
                });

                // Keep only latest 10
                if (this.activities.length > 10) {
                    this.activities = this.activities.slice(0, 10);
                }
            }

            formatPakistaniTime(date) {
                return date.toLocaleString('en-US', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: true,
                    timeZone: 'Asia/Karachi'
                });
            }

            getTimeRemaining(task) {
                if (task.isPaused) {
                    return task.totalTime;
                }
                const elapsed = Date.now() - task.startTime;
                const remaining = Math.max(0, task.totalTime - elapsed);
                return remaining;
            }

            formatTime(ms) {
                const totalSeconds = Math.floor(ms / 1000);
                const hours = Math.floor(totalSeconds / 3600);
                const minutes = Math.floor((totalSeconds % 3600) / 60);
                const seconds = totalSeconds % 60;
                const milliseconds = Math.floor((ms % 1000) / 10);

                return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}.${String(milliseconds).padStart(2, '0')}`;
            }

            getProgressPercent(task) {
                const remaining = this.getTimeRemaining(task);
                return Math.max(0, Math.min(100, ((task.totalTime - remaining) / task.totalTime) * 100));
            }

            renderRunningTasks() {
                const container = document.getElementById('runningTasks');
                if (this.tasks.running.length === 0) {
                    container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">‚è±Ô∏è</div><div class="empty-state-text">No running tasks. Create one above!</div></div>';
                    return;
                }

                container.innerHTML = this.tasks.running.map(task => {
                    const remaining = this.getTimeRemaining(task);
                    const progress = this.getProgressPercent(task);
                    const hasFireEffect = remaining < 10000; // Less than 10 seconds

                    return `
                        <div class="card">
                            <div class="task-header">
                                <div class="task-name">${task.name} ${hasFireEffect ? '<span class="fire-effect">üî•</span>' : ''}</div>
                            </div>
                            <div class="timer-display">${this.formatTime(remaining)}</div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progress}%"></div>
                            </div>
                            <div class="task-info">
                                <div class="task-info-item">
                                    <span>Reward:</span>
                                    <span>+${task.reward}</span>
                                </div>
                                <div class="task-info-item">
                                    <span>Penalty:</span>
                                    <span>-${task.penalty}</span>
                                </div>
                            </div>
                            <div class="task-controls">
                                <button class="button button-secondary button-small" onclick="app.pauseTask(${task.id})">‚è∏ Pause</button>
                                <button class="button button-success button-small" onclick="app.showCompletionModal(${task.id})">‚úÖ Done</button>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            renderPausedTasks() {
                const container = document.getElementById('pausedTasks');
                if (this.tasks.paused.length === 0) {
                    container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">‚è∏Ô∏è</div><div class="empty-state-text">No paused tasks</div></div>';
                    return;
                }

                container.innerHTML = this.tasks.paused.map(task => {
                    const remaining = task.totalTime;
                    const timeSpent = Date.now() - task.startTime;

                    return `
                        <div class="card">
                            <div class="task-header">
                                <div class="task-name">${task.name}</div>
                            </div>
                            <div class="timer-display">${this.formatTime(remaining)}</div>
                            <div class="task-info">
                                <div class="task-info-item">
                                    <span>Time Spent:</span>
                                    <span>${this.formatTime(timeSpent)}</span>
                                </div>
                                <div class="task-info-item">
                                    <span>Remaining:</span>
                                    <span>${this.formatTime(remaining)}</span>
                                </div>
                            </div>
                            <div class="task-controls">
                                <button class="button button-primary button-small" onclick="app.resumeTask(${task.id})">‚ñ∂Ô∏è Resume</button>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            renderCompletedTasks() {
                const container = document.getElementById('completedTasks');
                if (this.tasks.completed.length === 0) {
                    container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">‚úÖ</div><div class="empty-state-text">No completed tasks yet</div></div>';
                    return;
                }

                container.innerHTML = this.tasks.completed.map(task => {
                    return `
                        <div class="card">
                            <div class="task-header">
                                <div class="task-name">${task.name}</div>
                                <div class="task-status completed">Completed</div>
                            </div>
                            <div class="task-info">
                                <div class="task-info-item">
                                    <span>Total Time:</span>
                                    <span>${this.formatTime(task.totalTime)}</span>
                                </div>
                                <div class="task-info-item">
                                    <span>Reward:</span>
                                    <span>+${task.reward}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            renderNotCompletedTasks() {
                const container = document.getElementById('notCompletedTasks');
                if (this.tasks.notCompleted.length === 0) {
                    container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">‚ùå</div><div class="empty-state-text">No incomplete tasks</div></div>';
                    return;
                }

                container.innerHTML = this.tasks.notCompleted.map(task => {
                    return `
                        <div class="card">
                            <div class="task-header">
                                <div class="task-name">${task.name}</div>
                                <div class="task-status failed">Failed</div>
                            </div>
                            <div class="task-info">
                                <div class="task-info-item">
                                    <span>Total Time:</span>
                                    <span>${this.formatTime(task.totalTime)}</span>
                                </div>
                                <div class="task-info-item">
                                    <span>Penalty:</span>
                                    <span>-${task.penalty}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            renderLibraryTasks() {
                const container = document.getElementById('libraryTasks');
                if (this.tasks.library.length === 0) {
                    container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìö</div><div class="empty-state-text">No tasks in library yet</div></div>';
                    return;
                }

                container.innerHTML = this.tasks.library.map(task => {
                    const statusColors = {
                        'ready': '',
                        'running': 'background: var(--color-info); color: white;',
                        'paused': 'background: var(--color-warning); color: white;',
                        'completed': 'background: var(--color-success); color: white;',
                        'failed': 'background: var(--color-danger); color: white;'
                    };

                    return `
                        <div class="card">
                            <div class="task-header">
                                <div class="task-name">${task.name}</div>
                                ${task.status !== 'ready' ? `<div class="task-status" style="${statusColors[task.status]}">${task.status}</div>` : ''}
                            </div>
                            <div class="task-info">
                                <div class="task-info-item">
                                    <span>Time:</span>
                                    <span>${this.formatTime(task.totalTime)}</span>
                                </div>
                                <div class="task-info-item">
                                    <span>Reward/Penalty:</span>
                                    <span>+${task.reward} / -${task.penalty}</span>
                                </div>
                            </div>
                            <div class="task-controls">
                                ${(task.status === 'ready' || this.showAllLibraryControls) ? `<button class="button button-primary button-small" onclick="app.startLibraryTask(${task.id})">Start</button>` : ''}
                                ${this.showAllLibraryControls ? `<button class="button button-danger button-small" onclick="app.deleteLibraryTask(${task.id})">Delete</button>` : ''}
                            </div>
                        </div>
                    `;
                }).join('');
            }

            renderActivityLog() {
                const container = document.getElementById('activityLog');
                if (this.activities.length === 0) {
                    container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìã</div><div class="empty-state-text">No activities yet</div></div>';
                    return;
                }

                container.innerHTML = this.activities.map(activity => `
                    <div class="activity-item">
                        <div class="activity-text">${activity.text}</div>
                        <div class="activity-time">${activity.time}</div>
                    </div>
                `).join('');
            }

            showPage(page) {
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                const pageMap = {
                    'running': 'running-page',
                    'paused': 'paused-page',
                    'completed': 'completed-page',
                    'not-completed': 'not-completed-page',
                    'library': 'library-page',
                    'activity': 'activity-page'
                };
                document.getElementById(pageMap[page]).classList.add('active');
            }

            render() {
                this.renderRunningTasks();
                this.renderPausedTasks();
                this.renderCompletedTasks();
                this.renderNotCompletedTasks();
                this.renderLibraryTasks();
                this.renderActivityLog();

                document.getElementById('tokenDisplay').textContent = this.tokens;
            }

            startTimerLoop() {
                setInterval(() => {
                    // Check for completed timers
                    this.tasks.running.forEach(task => {
                        const remaining = this.getTimeRemaining(task);
                        if (remaining <= 0) {
                            this.showCompletionModal(task.id);
                        }
                    });

                    // Update display
                    this.render();
                }, 100);
            }

            setTheme(theme) {
                document.body.className = theme;
                localStorage.setItem('selectedTheme', theme);
            }

            saveToStorage() {
                localStorage.setItem('taskTimerData', JSON.stringify({
                    tasks: this.tasks,
                    tokens: this.tokens,
                    activities: this.activities
                }));
            }

            loadFromStorage() {
                const data = localStorage.getItem('taskTimerData');
                if (data) {
                    const parsed = JSON.parse(data);
                    this.tasks = parsed.tasks || this.tasks;
                    this.tokens = parsed.tokens || 0;
                    this.activities = parsed.activities || [];
                }

                const theme = localStorage.getItem('selectedTheme') || 'theme-pure-white';
                this.setTheme(theme);
            }
        }

        // Initialize app
        let app;
        document.addEventListener('DOMContentLoaded', () => {
            app = new TaskTimerApp();
        });
    </script>
</body>
</html>
