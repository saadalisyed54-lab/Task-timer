<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ZenFocus | Task Timer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #0f172a;
            --text-dim: #64748b;
            --accent: #6366f1;
            --accent-soft: rgba(99, 102, 241, 0.1);
            --danger: #f43f5e;
            --success: #10b981;
            --radius-lg: 24px;
            --radius-md: 16px;
            --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.05);
            --font-main: 'Plus Jakarta Sans', sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
        }

        /* THEME ENGINE */
        body.theme-1 { --bg: #f8fafc; --card: #ffffff; --text: #0f172a; --accent: #6366f1; } /* Light Slate */
        body.theme-2 { --bg: #020617; --card: #0f172a; --text: #f1f5f9; --accent: #818cf8; } /* Midnight */
        body.theme-3 { --bg: #fefaf3; --card: #ffffff; --text: #451a03; --accent: #d97706; } /* Sand */
        body.theme-4 { --bg: #f0fdf4; --card: #ffffff; --text: #064e3b; --accent: #10b981; } /* Forest */
        body.theme-5 { --bg: #faf5ff; --card: #ffffff; --text: #4c1d95; --accent: #a855f7; } /* Lavender */
        body.theme-6 { --bg: #fff1f2; --card: #ffffff; --text: #881337; --accent: #fb7185; } /* Rose */
        body.theme-7 { --bg: #000000; --card: #111111; --text: #ffffff; --accent: #ffffff; } /* Blackout */
        body.theme-8 { --bg: #111827; --card: #1f2937; --text: #f9fafb; --accent: #38bdf8; } /* Oceanic */

        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        
        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: var(--font-main);
            margin: 0;
            padding: 0;
            transition: background 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            line-height: 1.5;
            overflow-x: hidden;
        }

        header {
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
        }

        .logo { font-weight: 800; font-size: 1.4rem; letter-spacing: -1px; }
        
        .header-tools { display: flex; align-items: center; gap: 12px; }

        .token-badge {
            background: var(--card);
            padding: 8px 16px;
            border-radius: 100px;
            font-weight: 700;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0,0,0,0.05);
        }

        .theme-pill {
            background: var(--card);
            border: 1px solid rgba(0,0,0,0.05);
            padding: 6px 12px;
            border-radius: 100px;
            display: flex;
            align-items: center;
            box-shadow: var(--shadow);
        }

        select {
            background: transparent;
            border: none;
            color: var(--text);
            font-family: var(--font-main);
            font-weight: 600;
            font-size: 0.85rem;
            cursor: pointer;
        }

        nav {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(var(--card), 0.8);
            backdrop-filter: blur(12px);
            padding: 8px;
            border-radius: 100px;
            display: flex;
            gap: 4px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            z-index: 100;
            border: 1px solid rgba(255,255,255,0.1);
        }

        nav button {
            padding: 12px 20px;
            border: none;
            background: transparent;
            color: var(--text);
            font-weight: 700;
            font-size: 0.85rem;
            border-radius: 100px;
            cursor: pointer;
            transition: all 0.3s;
            opacity: 0.5;
        }

        nav button.active {
            background: var(--accent);
            color: #fff;
            opacity: 1;
        }

        main {
            max-width: 500px;
            margin: 0 auto;
            padding: 1rem 1.5rem 120px 1.5rem;
        }

        .page { display: none; animation: pageIn 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        .page.active { display: block; }

        @keyframes pageIn {
            from { opacity: 0; transform: translateY(20px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .card {
            background: var(--card);
            border-radius: var(--radius-lg);
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            transition: transform 0.3s;
        }

        .timer-hero {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
        }

        .progress-ring { transform: rotate(-90deg); }
        .progress-ring__circle {
            transition: stroke-dashoffset 0.1s linear;
            stroke: var(--accent);
            stroke-linecap: round;
        }

        .timer-text {
            position: absolute;
            font-family: var(--font-mono);
            font-size: 2.8rem;
            font-weight: 500;
            letter-spacing: -1px;
        }

        .input-stack { display: flex; flex-direction: column; gap: 12px; margin-bottom: 20px; }
        input {
            background: var(--bg);
            border: 2px solid transparent;
            padding: 16px;
            border-radius: var(--radius-md);
            color: var(--text);
            font-family: var(--font-main);
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s;
        }
        input:focus { border-color: var(--accent); background: var(--card); }

        .btn {
            padding: 16px 24px;
            border-radius: var(--radius-md);
            border: none;
            font-weight: 800;
            font-family: var(--font-main);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .btn-primary { background: var(--accent); color: white; }
        .btn-ghost { background: var(--accent-soft); color: var(--accent); }
        .btn-danger { background: rgba(244, 63, 94, 0.1); color: var(--danger); }
        .btn:active { transform: scale(0.96); opacity: 0.8; }

        /* MODAL */
        #modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.4); 
            backdrop-filter: blur(10px); z-index: 1000;
            display: none; align-items: center; justify-content: center; padding: 20px;
        }
        #modal.active { display: flex; }
        .modal-content {
            background: var(--card); padding: 40px; border-radius: 32px;
            width: 100%; max-width: 400px; text-align: center;
            animation: modalPop 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        @keyframes modalPop { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .empty-state {
            text-align: center; padding: 40px 20px; opacity: 0.5;
        }

        .history-card {
            display: flex; justify-content: space-between; align-items: center;
            padding: 16px; border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        .history-card:last-child { border: none; }

        /* CUSTOM SCROLLBAR */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--accent-soft); border-radius: 10px; }
    </style>
</head>
<body class="theme-1">

<header>
    <div class="logo">ZenFocus</div>
    <div class="header-tools">
        <div class="token-badge">ðŸª™ <span id="token-count">0</span></div>
        <div class="theme-pill">
            <select id="theme-selector" onchange="changeTheme()"></select>
        </div>
    </div>
</header>

<nav>
    <button onclick="showPage('running')" id="nav-running" class="active">Focus</button>
    <button onclick="showPage('history')" id="nav-history">History</button>
    <button onclick="showPage('library')" id="nav-library">Library</button>
</nav>

<main>
    <!-- FOCUS PAGE -->
    <div id="running" class="page active">
        <div class="card" style="margin-bottom: 30px;">
            <div class="input-stack">
                <input type="text" id="task-name" placeholder="What are you focusing on?">
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                    <input type="number" id="task-time" placeholder="Mins">
                    <input type="number" id="task-reward" placeholder="Reward">
                </div>
            </div>
            <button class="btn btn-primary" style="width:100%" onclick="startTask()">Start Session</button>
        </div>
        
        <div id="running-list"></div>
    </div>

    <!-- HISTORY PAGE -->
    <div id="history" class="page">
        <div class="card">
            <h2 style="margin-top:0">Activity Log</h2>
            <div id="history-list"></div>
            <button class="btn btn-danger" style="width:100%; margin-top:20px" onclick="clearHistory()">Clear History</button>
        </div>
    </div>

    <!-- LIBRARY PAGE -->
    <div id="library" class="page">
        <div class="card">
            <h3>Routine Library</h3>
            <div class="input-stack">
                <input type="text" id="lib-name" placeholder="Routine Name">
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                    <input type="number" id="lib-time" placeholder="Mins">
                    <input type="number" id="lib-reward" placeholder="Reward">
                </div>
            </div>
            <button class="btn btn-ghost" style="width:100%" onclick="addToLibrary()">Add to Library</button>
        </div>
        <div id="library-list"></div>
        <div style="margin-top: 40px; border-top: 1px solid rgba(0,0,0,0.1); padding-top: 20px;">
            <button class="btn btn-danger" style="width:100%" onclick="masterReset()">Master Reset System</button>
        </div>
    </div>
</main>

<div id="modal">
    <div class="modal-content">
        <h1 id="modal-title">Session Complete</h1>
        <p id="modal-desc">Great job! Did you complete the task?</p>
        <div style="display:flex; flex-direction:column; gap:12px; margin-top:30px">
            <button class="btn btn-primary" style="background:var(--success)" onclick="resolveTask(true)">Yes, I did it</button>
            <button class="btn btn-danger" onclick="resolveTask(false)">No, I didn't</button>
        </div>
    </div>
</div>

<script>
    let state = {
        tasks: [],
        library: [],
        tokens: 0,
        themeIndex: 0
    };

    const CIRCLE_RADIUS = 70;
    const CIRCLE_CIRCUMFERENCE = 2 * Math.PI * CIRCLE_RADIUS;

    function init() {
        const saved = localStorage.getItem('zenFocusState');
        if (saved) state = JSON.parse(saved);
        
        initThemes();
        applyTheme();
        renderAll();
        requestAnimationFrame(tick);
    }

    function save() {
        localStorage.setItem('zenFocusState', JSON.stringify(state));
        renderAll();
    }

    function startTask(name, mins, reward) {
        const n = name || document.getElementById('task-name').value;
        const m = mins || parseFloat(document.getElementById('task-time').value);
        const r = reward || parseFloat(document.getElementById('task-reward').value) || 0;

        if (!n || isNaN(m)) return;

        const ms = m * 60 * 1000;
        state.tasks.push({
            id: Date.now().toString(36),
            name: n,
            total: ms,
            end: Date.now() + ms,
            reward: r,
            status: 'running'
        });

        if (!name) {
            document.getElementById('task-name').value = '';
            document.getElementById('task-time').value = '';
            document.getElementById('task-reward').value = '';
        }
        save();
    }

    let activeModalTask = null;

    function tick() {
        const now = Date.now();
        let needsSave = false;

        state.tasks.forEach(t => {
            if (t.status === 'running') {
                const rem = t.end - now;
                const progress = Math.max(0, rem / t.total);
                
                // Update UI elements if they exist
                const textEl = document.getElementById(`text-${t.id}`);
                const ringEl = document.getElementById(`ring-${t.id}`);
                
                if (textEl) textEl.innerText = formatTime(Math.max(0, rem));
                if (ringEl) {
                    const offset = CIRCLE_CIRCUMFERENCE - (progress * CIRCLE_CIRCUMFERENCE);
                    ringEl.style.strokeDashoffset = offset;
                }

                if (rem <= 0) {
                    t.status = 'alert';
                    activeModalTask = t;
                    showModal(t);
                    needsSave = true;
                }
            }
        });

        if (needsSave) save();
        requestAnimationFrame(tick);
    }

    function formatTime(ms) {
        const s = Math.floor(ms / 1000);
        const m = Math.floor(s / 60);
        const sec = s % 60;
        return `${m}:${sec.toString().padStart(2, '0')}`;
    }

    function showModal(t) {
        document.getElementById('modal-title').innerText = t.name;
        document.getElementById('modal').classList.add('active');
    }

    function resolveTask(success) {
        document.getElementById('modal').classList.remove('active');
        if (!activeModalTask) return;

        activeModalTask.status = success ? 'done' : 'failed';
        if (success) state.tokens += activeModalTask.reward;
        else state.tokens = Math.max(0, state.tokens - (activeModalTask.reward / 2));
        
        activeModalTask = null;
        save();
    }

    function renderAll() {
        document.getElementById('token-count').innerText = state.tokens;
        
        // Render Running
        const runningList = document.getElementById('running-list');
        const activeTasks = state.tasks.filter(x => x.status === 'running');
        if (activeTasks.length === 0) {
            runningList.innerHTML = `<div class="empty-state">No active sessions. Start one above.</div>`;
        } else {
            runningList.innerHTML = activeTasks.map(t => `
                <div class="card timer-hero">
                    <svg class="progress-ring" width="160" height="160">
                        <circle stroke="var(--accent-soft)" stroke-width="8" fill="transparent" r="${CIRCLE_RADIUS}" cx="80" cy="80"/>
                        <circle id="ring-${t.id}" class="progress-ring__circle" stroke-width="8" 
                            stroke-dasharray="${CIRCLE_CIRCUMFERENCE} ${CIRCLE_CIRCUMFERENCE}" 
                            stroke-dashoffset="${CIRCLE_CIRCUMFERENCE}"
                            fill="transparent" r="${CIRCLE_RADIUS}" cx="80" cy="80"/>
                    </svg>
                    <div class="timer-text" id="text-${t.id}">--:--</div>
                    <div style="position:absolute; bottom: -10px; font-weight:700; opacity:0.6">${t.name}</div>
                </div>
                <button class="btn btn-danger" style="width:100%; margin-bottom:40px" onclick="cancelTask('${t.id}')">Cancel Session</button>
            `).join('');
        }

        // Render History
        const historyList = document.getElementById('history-list');
        const completed = state.tasks.filter(x => x.status !== 'running' && x.status !== 'alert');
        if (completed.length === 0) {
            historyList.innerHTML = `<div class="empty-state">No history yet.</div>`;
        } else {
            historyList.innerHTML = completed.reverse().map(t => `
                <div class="history-card">
                    <div>
                        <div style="font-weight:700">${t.name}</div>
                        <div style="font-size:0.7rem; color:var(--text-dim)">${Math.round(t.total/60000)} mins</div>
                    </div>
                    <div style="font-weight:800; color:${t.status === 'done' ? 'var(--success)' : 'var(--danger)'}">
                        ${t.status === 'done' ? '+'+t.reward : 'Failed'}
                    </div>
                </div>
            `).join('');
        }

        // Render Library
        const libList = document.getElementById('library-list');
        if (state.library.length === 0) {
            libList.innerHTML = `<div class="empty-state">Library is empty.</div>`;
        } else {
            libList.innerHTML = state.library.map(i => {
                const isRunning = state.tasks.some(t => t.name === i.name && t.status === 'running');
                return `
                <div class="card" style="display:flex; justify-content:space-between; align-items:center; padding:16px 24px">
                    <div>
                        <div style="font-weight:800">${i.name}</div>
                        <div style="font-size:0.8rem; opacity:0.6">${i.mins}m â€¢ ðŸª™${i.reward}</div>
                    </div>
                    <div style="display:flex; gap:8px">
                        ${isRunning ? `<span style="font-size:0.7rem; font-weight:700; color:var(--accent)">Active</span>` : 
                        `<button class="btn btn-primary" style="padding:8px 16px" onclick="startFromLib('${i.id}')">Start</button>`}
                        <button class="btn btn-danger" style="padding:8px" onclick="removeFromLib('${i.id}')">âœ•</button>
                    </div>
                </div>
            `}).join('');
        }
    }

    function cancelTask(id) {
        state.tasks = state.tasks.filter(x => x.id !== id);
        save();
    }

    function clearHistory() {
        state.tasks = state.tasks.filter(x => x.status === 'running');
        save();
    }

    function addToLibrary() {
        const n = document.getElementById('lib-name').value;
        const m = parseFloat(document.getElementById('lib-time').value);
        const r = parseFloat(document.getElementById('lib-reward').value) || 0;
        if (!n || isNaN(m)) return;

        state.library.push({ id: Date.now().toString(36), name: n, mins: m, reward: r });
        document.getElementById('lib-name').value = '';
        document.getElementById('lib-time').value = '';
        document.getElementById('lib-reward').value = '';
        save();
    }

    function startFromLib(id) {
        const item = state.library.find(x => x.id === id);
        if (item) startTask(item.name, item.mins, item.reward);
        showPage('running');
    }

    function removeFromLib(id) {
        state.library = state.library.filter(x => x.id !== id);
        save();
    }

    function showPage(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.getElementById('nav-' + id).classList.add('active');
        window.scrollTo(0,0);
    }

    const themes = ["Zen White", "Midnight", "Desert", "Emerald", "Amethyst", "Blush", "High Contrast", "Ocean"];
    function initThemes() {
        const s = document.getElementById('theme-selector');
        themes.forEach((t, i) => s.add(new Option(t, i)));
        s.value = state.themeIndex;
    }
    function changeTheme() {
        state.themeIndex = document.getElementById('theme-selector').value;
        applyTheme();
        save();
    }
    function applyTheme() {
        document.body.className = `theme-${parseInt(state.themeIndex) + 1}`;
    }

    function masterReset() {
        if (confirm("Wipe everything?")) {
            localStorage.clear();
            location.reload();
        }
    }

    init();
</script>
</body>
</html>

