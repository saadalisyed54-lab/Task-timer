<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Timer Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --secondary: #ec4899;
            --accent: #14b8a6;
            --bg: #ffffff;
            --fg: #000000;
            --card-bg: #f5f5f5;
            --border: #e0e0e0;
            --text: #1a1a1a;
            --muted: #666666;
        }

        /* 20 Premium Themes */
        body.theme-arctic {
            --primary: #0ea5e9;
            --secondary: #06b6d4;
            --accent: #10b981;
            --bg: #f0f9ff;
            --fg: #0c2340;
            --card-bg: #e0f2fe;
            --border: #bae6fd;
            --text: #0c2340;
        }

        body.theme-midnight {
            --primary: #60a5fa;
            --secondary: #a78bfa;
            --accent: #34d399;
            --bg: #0f172a;
            --fg: #ffffff;
            --card-bg: #1e293b;
            --border: #334155;
            --text: #f1f5f9;
        }

        body.theme-sunset {
            --primary: #f97316;
            --secondary: #ef4444;
            --accent: #eab308;
            --bg: #fef3c7;
            --fg: #78350f;
            --card-bg: #fde68a;
            --border: #fcd34d;
            --text: #78350f;
        }

        body.theme-forest {
            --primary: #10b981;
            --secondary: #059669;
            --accent: #34d399;
            --bg: #ecfdf5;
            --fg: #064e3b;
            --card-bg: #d1fae5;
            --border: #a7f3d0;
            --text: #064e3b;
        }

        body.theme-lavender {
            --primary: #a78bfa;
            --secondary: #c4b5fd;
            --accent: #e9d5ff;
            --bg: #faf5ff;
            --fg: #5b21b6;
            --card-bg: #f3e8ff;
            --border: #e9d5ff;
            --text: #5b21b6;
        }

        body.theme-ocean {
            --primary: #0369a1;
            --secondary: #075985;
            --accent: #06b6d4;
            --bg: #e0f2fe;
            --fg: #003f5c;
            --card-bg: #bae6fd;
            --border: #7dd3fc;
            --text: #003f5c;
        }

        body.theme-coral {
            --primary: #ff6b6b;
            --secondary: #ff8787;
            --accent: #ffd43b;
            --bg: #fff5f5;
            --fg: #5c2e2e;
            --card-bg: #ffe0e0;
            --border: #ffb3b3;
            --text: #5c2e2e;
        }

        body.theme-charcoal {
            --primary: #9ca3af;
            --secondary: #6b7280;
            --accent: #d1d5db;
            --bg: #1f2937;
            --fg: #f3f4f6;
            --card-bg: #111827;
            --border: #374151;
            --text: #e5e7eb;
        }

        body.theme-mint {
            --primary: #14b8a6;
            --secondary: #2dd4bf;
            --accent: #5eead4;
            --bg: #f0fdfa;
            --fg: #134e4a;
            --card-bg: #ccfbf1;
            --border: #99f6e4;
            --text: #134e4a;
        }

        body.theme-rose {
            --primary: #e11d48;
            --secondary: #f43f5e;
            --accent: #fb7185;
            --bg: #fff1f2;
            --fg: #831843;
            --card-bg: #ffe4e6;
            --border: #fbcfe8;
            --text: #831843;
        }

        body.theme-pure-white {
            --primary: #000000;
            --secondary: #333333;
            --accent: #666666;
            --bg: #ffffff;
            --fg: #000000;
            --card-bg: #f9f9f9;
            --border: #e0e0e0;
            --text: #000000;
        }

        body.theme-pure-black {
            --primary: #ffffff;
            --secondary: #e0e0e0;
            --accent: #b0b0b0;
            --bg: #000000;
            --fg: #ffffff;
            --card-bg: #1a1a1a;
            --border: #333333;
            --text: #ffffff;
        }

        body.theme-neon {
            --primary: #00ff88;
            --secondary: #ff00ff;
            --accent: #00ffff;
            --bg: #0d0221;
            --fg: #00ff88;
            --card-bg: #1a0033;
            --border: #ff00ff;
            --text: #00ff88;
        }

        body.theme-gold {
            --primary: #d97706;
            --secondary: #b45309;
            --accent: #f59e0b;
            --bg: #fffbeb;
            --fg: #78350f;
            --card-bg: #fef3c7;
            --border: #fde68a;
            --text: #78350f;
        }

        body.theme-violet {
            --primary: #7c3aed;
            --secondary: #6d28d9;
            --accent: #a78bfa;
            --bg: #faf5ff;
            --fg: #4c1d95;
            --card-bg: #ede9fe;
            --border: #ddd6fe;
            --text: #4c1d95;
        }

        body.theme-indigo {
            --primary: #4f46e5;
            --secondary: #4338ca;
            --accent: #818cf8;
            --bg: #f0f4ff;
            --fg: #1e1b4b;
            --card-bg: #e0e7ff;
            --border: #c7d2fe;
            --text: #1e1b4b;
        }

        body.theme-teal {
            --primary: #0d9488;
            --secondary: #115e59;
            --accent: #2dd4bf;
            --bg: #f0fdfa;
            --fg: #0f766e;
            --card-bg: #ccfbf1;
            --border: #99f6e4;
            --text: #0f766e;
        }

        body.theme-slate {
            --primary: #64748b;
            --secondary: #475569;
            --accent: #94a3b8;
            --bg: #f8fafc;
            --fg: #1e293b;
            --card-bg: #f1f5f9;
            --border: #cbd5e1;
            --text: #1e293b;
        }

        body.theme-emerald {
            --primary: #047857;
            --secondary: #065f46;
            --accent: #10b981;
            --bg: #f0fdf4;
            --fg: #065f46;
            --card-bg: #dcfce7;
            --border: #bbf7d0;
            --text: #065f46;
        }

        body.theme-red-passion {
            --primary: #dc2626;
            --secondary: #991b1b;
            --accent: #fca5a5;
            --bg: #fef2f2;
            --fg: #7f1d1d;
            --card-bg: #fee2e2;
            --border: #fecaca;
            --text: #7f1d1d;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: background-color 0.3s ease, color 0.3s ease;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 30px;
            gap: 20px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .theme-btn {
            background: var(--card-bg);
            border: 2px solid var(--border);
            color: var(--text);
            padding: 10px 15px;
            cursor: pointer;
            font-size: 18px;
            border-radius: 8px;
            position: relative;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .theme-btn:hover {
            background: var(--primary);
            color: var(--bg);
            transform: scale(1.05);
        }

        .theme-menu {
            position: absolute;
            top: 100%;
            left: 0;
            background: var(--card-bg);
            border: 2px solid var(--border);
            border-radius: 8px;
            margin-top: 5px;
            display: none;
            flex-direction: column;
            max-height: 400px;
            overflow-y: auto;
            z-index: 1000;
            min-width: 200px;
        }

        .theme-menu.active {
            display: flex;
        }

        .theme-option {
            padding: 12px 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 1px solid var(--border);
            font-size: 14px;
        }

        .theme-option:last-child {
            border-bottom: none;
        }

        .theme-option:hover {
            background: var(--primary);
            color: var(--bg);
        }

        h1 {
            font-size: 2.5em;
            margin: 0;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .token-display {
            font-size: 1.3em;
            font-weight: bold;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .token-display span {
            background: var(--primary);
            color: var(--bg);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 1.1em;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: flex-end;
        }

        .nav-btn {
            background: var(--primary);
            color: var(--bg);
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 8px;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .nav-btn:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }

        .nav-btn.active {
            background: var(--secondary);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .task-form {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            border: 2px solid var(--border);
        }

        .form-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--primary);
            font-size: 0.9em;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            background: var(--bg);
            color: var(--text);
            font-size: 1em;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .form-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 0.95em;
        }

        .btn-primary {
            background: var(--primary);
            color: var(--bg);
        }

        .btn-primary:hover {
            background: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-warning {
            background: #f59e0b;
            color: white;
        }

        .btn-warning:hover {
            background: #d97706;
        }

        .btn-secondary {
            background: var(--card-bg);
            color: var(--text);
            border: 2px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--border);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.85em;
        }

        .tasks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .task-card {
            background: var(--card-bg);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            position: relative;
        }

        .task-card:hover {
            box-shadow: 0 8px 24px rgba(0,0,0,0.1);
            transform: translateY(-4px);
            border-color: var(--primary);
        }

        .task-name {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 12px;
            color: var(--primary);
        }

        .task-info {
            margin-bottom: 15px;
            font-size: 0.95em;
            color: var(--text);
        }

        .timer-display {
            font-size: 3em;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .progress-bar-container {
            width: 100%;
            height: 8px;
            background: var(--border);
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 10px;
            transition: width 0.1s linear;
            box-shadow: 0 0 10px var(--primary);
        }

        .task-controls {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .task-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.85em;
            color: var(--muted);
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--muted);
        }

        .empty-state-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .empty-state h2 {
            color: var(--text);
            margin-bottom: 10px;
        }

        .completion-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .completion-popup.active {
            display: flex;
            animation: popupAppear 0.3s ease;
        }

        @keyframes popupAppear {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .popup-content {
            background: var(--card-bg);
            padding: 40px;
            border-radius: 16px;
            text-align: center;
            max-width: 400px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            border: 3px solid var(--primary);
        }

        .popup-content h2 {
            font-size: 2em;
            margin-bottom: 20px;
            color: var(--primary);
        }

        .popup-content .task-name {
            margin-bottom: 30px;
            font-size: 1.4em;
        }

        .popup-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .popup-buttons .btn {
            flex: 1;
            min-width: 120px;
        }

        .activity-log {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .activity-item {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
            font-size: 0.95em;
        }

        .activity-time {
            color: var(--muted);
            font-size: 0.85em;
            margin-top: 5px;
        }

        .controls-section {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--card-bg);
            border-radius: 12px;
            border: 2px solid var(--border);
        }

        .library-toggle {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
            padding: 15px;
            background: var(--card-bg);
            border-radius: 8px;
            border: 2px solid var(--border);
        }

        .library-status {
            font-weight: bold;
            color: var(--primary);
            flex: 1;
        }

        .fire-effect {
            position: absolute;
            font-size: 2em;
            opacity: 0.6;
            animation: fireFloat 2s ease-in-out infinite;
        }

        .fire-left {
            left: 10px;
            animation-delay: 0s;
        }

        .fire-right {
            right: 10px;
            animation-delay: 0.3s;
        }

        @keyframes fireFloat {
            0%, 100% {
                transform: translateY(0px);
                opacity: 0.6;
            }
            50% {
                transform: translateY(-20px);
                opacity: 0.3;
            }
        }

        .stat-box {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 8px;
            border: 2px solid var(--border);
            margin-bottom: 10px;
        }

        .stat-label {
            color: var(--muted);
            font-size: 0.85em;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.3em;
            font-weight: bold;
            color: var(--primary);
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            h1 {
                font-size: 1.8em;
            }

            header {
                flex-direction: column;
                gap: 15px;
            }

            .nav-buttons {
                width: 100%;
            }

            .nav-btn {
                flex: 1;
                min-width: 0;
            }

            .tasks-grid {
                grid-template-columns: 1fr;
            }

            .timer-display {
                font-size: 2em;
            }

            .form-group {
                grid-template-columns: 1fr;
            }

            .popup-buttons {
                flex-direction: column;
            }

            .popup-content {
                padding: 25px;
                margin: 20px;
            }

            .task-controls {
                justify-content: space-around;
            }

            header {
                align-items: flex-start;
            }

            .theme-menu {
                max-width: calc(100vw - 40px);
            }
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 5000;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 12px;
            border: 2px solid var(--border);
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 20px;
            color: var(--primary);
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-footer {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .token-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .token-input-group input {
            flex: 1;
        }

        .token-input-group .btn {
            padding: 12px 20px;
        }

        .reset-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding: 12px;
            background: var(--bg);
            border-radius: 8px;
            cursor: pointer;
        }

        .reset-checkbox input[type="checkbox"] {
            width: auto;
            cursor: pointer;
        }

        .task-status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75em;
            font-weight: bold;
            margin-top: 5px;
        }

        .badge-running {
            background: #fca5a5;
            color: #7f1d1d;
        }

        .badge-paused {
            background: #fed7aa;
            color: #92400e;
        }

        .badge-completed {
            background: #bbf7d0;
            color: #065f46;
        }

        .badge-failed {
            background: #f5d8d8;
            color: #7f1d1d;
        }

        .library-task-item {
            background: var(--card-bg);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .library-task-info {
            flex: 1;
        }

        .library-task-name {
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .library-task-details {
            font-size: 0.85em;
            color: var(--muted);
        }

        .library-task-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
    </style>
</head>
<body class="theme-arctic">
<div class="container">
    <header>
        <div class="header-left">
            <div style="position: relative;">
                <button class="theme-btn" onclick="toggleThemeMenu()">üé®</button>
                <div class="theme-menu" id="themeMenu">
                    <div class="theme-option" onclick="setTheme('arctic')">Arctic Blue</div>
                    <div class="theme-option" onclick="setTheme('midnight')">Midnight</div>
                    <div class="theme-option" onclick="setTheme('sunset')">Sunset</div>
                    <div class="theme-option" onclick="setTheme('forest')">Forest Green</div>
                    <div class="theme-option" onclick="setTheme('lavender')">Lavender</div>
                    <div class="theme-option" onclick="setTheme('ocean')">Ocean</div>
                    <div class="theme-option" onclick="setTheme('coral')">Coral</div>
                    <div class="theme-option" onclick="setTheme('charcoal')">Charcoal</div>
                    <div class="theme-option" onclick="setTheme('mint')">Mint</div>
                    <div class="theme-option" onclick="setTheme('rose')">Rose</div>
                    <div class="theme-option" onclick="setTheme('pure-white')">Pure White</div>
                    <div class="theme-option" onclick="setTheme('pure-black')">Pure Black</div>
                    <div class="theme-option" onclick="setTheme('neon')">Neon</div>
                    <div class="theme-option" onclick="setTheme('gold')">Gold</div>
                    <div class="theme-option" onclick="setTheme('violet')">Violet</div>
                    <div class="theme-option" onclick="setTheme('indigo')">Indigo</div>
                    <div class="theme-option" onclick="setTheme('teal')">Teal</div>
                    <div class="theme-option" onclick="setTheme('slate')">Slate</div>
                    <div class="theme-option" onclick="setTheme('emerald')">Emerald</div>
                    <div class="theme-option" onclick="setTheme('red-passion')">Red Passion</div>
                </div>
            </div>
            <h1>Task Timer</h1>
        </div>
        <div class="token-display">
            üíé <span id="tokenCount">0</span>
        </div>
    </header>

    <div class="nav-buttons">
        <button class="nav-btn active" onclick="switchPage('running')">‚è±Ô∏è Running</button>
        <button class="nav-btn" onclick="switchPage('paused')">‚è∏Ô∏è Paused</button>
        <button class="nav-btn" onclick="switchPage('completed')">‚úÖ Completed</button>
        <button class="nav-btn" onclick="switchPage('notcompleted')">‚ùå Not Completed</button>
        <button class="nav-btn" onclick="switchPage('library')">üìö Library</button>
        <button class="nav-btn" onclick="switchPage('activity')">üìã Activity</button>
    </div>

    <!-- RUNNING TASKS PAGE -->
    <div id="running" class="page active">
        <div class="task-form">
            <h2 style="color: var(--primary); margin-bottom: 15px;">Create New Task</h2>
            <div class="form-group">
                <div>
                    <label>Task Name</label>
                    <input type="text" id="taskName" placeholder="Enter task name">
                </div>
                <div>
                    <label>Total Time (minutes)</label>
                    <input type="number" id="taskTime" placeholder="e.g., 25">
                </div>
                <div>
                    <label>Reward Tokens</label>
                    <input type="number" id="rewardTokens" placeholder="e.g., 10">
                </div>
                <div>
                    <label>Penalty Tokens</label>
                    <input type="number" id="penaltyTokens" placeholder="e.g., 5">
                </div>
            </div>
            <div class="form-actions">
                <button class="btn btn-primary" onclick="createTask()">Start Task</button>
                <button class="btn btn-secondary" onclick="resetRunning()">Reset Running Tasks</button>
                <button class="btn btn-danger" onclick="masterReset()">Master Reset</button>
            </div>
        </div>

        <div id="runningTasks" class="tasks-grid"></div>
        <div id="runningEmpty" class="empty-state" style="display: none;">
            <div class="empty-state-icon">‚è±Ô∏è</div>
            <h2>No Running Tasks</h2>
            <p>Create a new task to get started!</p>
        </div>
    </div>

    <!-- PAUSED TASKS PAGE -->
    <div id="paused" class="page">
        <div class="controls-section">
            <button class="btn btn-secondary" onclick="resetPaused()">Reset Paused Tasks</button>
        </div>
        <div id="pausedTasks" class="tasks-grid"></div>
        <div id="pausedEmpty" class="empty-state" style="display: none;">
            <div class="empty-state-icon">‚è∏Ô∏è</div>
            <h2>No Paused Tasks</h2>
            <p>Pause a running task to see it here.</p>
        </div>
    </div>

    <!-- COMPLETED TASKS PAGE -->
    <div id="completed" class="page">
        <div class="controls-section">
            <button class="btn btn-secondary" onclick="resetCompleted()">Reset Completed Tasks</button>
        </div>
        <div id="completedTasks" class="tasks-grid"></div>
        <div id="completedEmpty" class="empty-state" style="display: none;">
            <div class="empty-state-icon">‚úÖ</div>
            <h2>No Completed Tasks</h2>
            <p>Complete a task to see it here.</p>
        </div>
    </div>

    <!-- NOT COMPLETED TASKS PAGE -->
    <div id="notcompleted" class="page">
        <div class="controls-section">
            <button class="btn btn-secondary" onclick="resetNotCompleted()">Reset Not Completed Tasks</button>
        </div>
        <div id="notcompletedTasks" class="tasks-grid"></div>
        <div id="notcompletedEmpty" class="empty-state" style="display: none;">
            <div class="empty-state-icon">‚ùå</div>
            <h2>No Not Completed Tasks</h2>
            <p>Fail a task to see it here.</p>
        </div>
    </div>

    <!-- LIBRARY PAGE -->
    <div id="library" class="page">
        <div class="task-form">
            <h2 style="color: var(--primary); margin-bottom: 15px;">Add to Task Library</h2>
            <div class="form-group">
                <div>
                    <label>Task Name</label>
                    <input type="text" id="libTaskName" placeholder="Enter task name">
                </div>
                <div>
                    <label>Total Time (minutes)</label>
                    <input type="number" id="libTaskTime" placeholder="e.g., 25">
                </div>
                <div>
                    <label>Reward Tokens</label>
                    <input type="number" id="libRewardTokens" placeholder="e.g., 10">
                </div>
                <div>
                    <label>Penalty Tokens</label>
                    <input type="number" id="libPenaltyTokens" placeholder="e.g., 5">
                </div>
            </div>
            <div class="form-actions">
                <button class="btn btn-primary" onclick="addToLibrary()">Add to Library</button>
            </div>
        </div>

        <div class="library-toggle">
            <label class="library-status">
                <input type="checkbox" id="showAllControls" onchange="toggleLibraryControls()">
                Show All Task Controls
            </label>
            <button class="btn btn-secondary btn-sm" onclick="resetLibrary()">Reset Library Tasks</button>
        </div>

        <div id="libraryTasks"></div>
        <div id="libraryEmpty" class="empty-state" style="display: none;">
            <div class="empty-state-icon">üìö</div>
            <h2>Task Library Empty</h2>
            <p>Add templates to your library for quick task creation.</p>
        </div>
    </div>

    <!-- ACTIVITY LOG PAGE -->
    <div id="activity" class="page">
        <div class="controls-section">
            <div style="flex: 1;">
                <label style="margin-bottom: 8px; display: block;">Manually Add/Subtract Tokens</label>
                <div class="token-input-group">
                    <input type="number" id="manualTokenInput" placeholder="Amount (use negative to subtract)">
                    <button class="btn btn-primary" onclick="addManualTokens()">Add Tokens</button>
                </div>
            </div>
            <button class="btn btn-danger" onclick="resetTokens()">Reset Tokens</button>
        </div>

        <h2 style="color: var(--primary); margin-bottom: 20px;">Activity Log (Latest 10)</h2>
        <div class="activity-log" id="activityLog"></div>
        <div id="activityEmpty" class="empty-state" style="display: none;">
            <div class="empty-state-icon">üìã</div>
            <h2>No Activities</h2>
            <p>Activities will appear as you create and manage tasks.</p>
        </div>
    </div>
</div>

<!-- COMPLETION POPUP -->
<div class="completion-popup" id="completionPopup">
    <div class="popup-content">
        <h2>Task Complete!</h2>
        <div class="task-name" id="popupTaskName"></div>
        <div style="margin-bottom: 20px;">
            <p style="color: var(--muted); font-size: 0.9em;">Did you complete this task?</p>
        </div>
        <div class="popup-buttons">
            <button class="btn btn-success" onclick="confirmCompletion(true)">‚úÖ Yes, Completed</button>
            <button class="btn btn-danger" onclick="confirmCompletion(false)">‚ùå Not Completed</button>
        </div>
    </div>
</div>

<script>
    // ===================== DATA STRUCTURE =====================
    let appState = {
        running: [],
        paused: [],
        completed: [],
        notcompleted: [],
        library: [],
        tokens: 0,
        activities: [],
        currentTheme: 'arctic',
        showAllLibraryControls: false,
        pendingCompletion: null
    };

    const STORAGE_KEY = 'taskTimerAppState';
    const ACTIVITY_LIMIT = 10;

    // ===================== INITIALIZATION =====================
    function initApp() {
        loadAppState();
        setTheme(appState.currentTheme);
        renderAll();
        startUpdateLoop();
    }

    function loadAppState() {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) {
            appState = JSON.parse(saved);
        }
        updateTokenDisplay();
    }

    function saveAppState() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(appState));
    }

    // ===================== THEME MANAGEMENT =====================
    function toggleThemeMenu() {
        const menu = document.getElementById('themeMenu');
        menu.classList.toggle('active');
        document.addEventListener('click', closeThemeMenuOnClickOutside);
    }

    function closeThemeMenuOnClickOutside(e) {
        const menu = document.getElementById('themeMenu');
        const btn = document.querySelector('.theme-btn');
        if (!menu.contains(e.target) && !btn.contains(e.target)) {
            menu.classList.remove('active');
            document.removeEventListener('click', closeThemeMenuOnClickOutside);
        }
    }

    function setTheme(theme) {
        document.body.className = `theme-${theme}`;
        appState.currentTheme = theme;
        saveAppState();
        document.getElementById('themeMenu').classList.remove('active');
        logActivity(`Theme changed to ${theme}`);
    }

    // ===================== PAGE NAVIGATION =====================
    function switchPage(pageName) {
        document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
        document.getElementById(pageName).classList.add('active');
        event.target.classList.add('active');
    }

    // ===================== TASK MANAGEMENT =====================
    function createTask() {
        const name = document.getElementById('taskName').value.trim();
        const time = parseInt(document.getElementById('taskTime').value);
        const reward = parseInt(document.getElementById('rewardTokens').value) || 0;
        const penalty = parseInt(document.getElementById('penaltyTokens').value) || 0;

        if (!name || !time || time <= 0) {
            alert('Please fill in task name and valid time');
            return;
        }

        const task = {
            id: Date.now(),
            name,
            totalMinutes: time,
            reward,
            penalty,
            startTime: Date.now(),
            pausedTime: 0,
            status: 'running'
        };

        appState.running.push(task);
        saveAppState();
        logActivity(`Task started: ${name}`);

        document.getElementById('taskName').value = '';
        document.getElementById('taskTime').value = '';
        document.getElementById('rewardTokens').value = '';
        document.getElementById('penaltyTokens').value = '';

        renderRunning();
    }

    function getElapsedMs(task) {
        if (task.status === 'paused') {
            return task.pausedTime;
        }
        return Date.now() - task.startTime + task.pausedTime;
    }

    function getRemainingMs(task) {
        const totalMs = task.totalMinutes * 60 * 1000;
        const elapsed = getElapsedMs(task);
        return Math.max(0, totalMs - elapsed);
    }

    function formatTime(ms) {
        const totalSeconds = Math.floor(ms / 1000);
        const hours = Math.floor(totalSeconds / 3600);
        const minutes = Math.floor((totalSeconds % 3600) / 60);
        const seconds = totalSeconds % 60;
        const milliseconds = Math.floor((ms % 1000) / 100);

        if (hours > 0) {
            return `${hours}h ${minutes}m ${seconds}s`;
        } else if (minutes > 0) {
            return `${minutes}m ${seconds}s`;
        } else {
            return `${seconds}.${milliseconds}s`;
        }
    }

    function pauseTask(taskId) {
        const task = appState.running.find(t => t.id === taskId);
        if (task) {
            task.pausedTime = getElapsedMs(task);
            task.status = 'paused';
            appState.paused.push(task);
            appState.running = appState.running.filter(t => t.id !== taskId);
            saveAppState();
            logActivity(`Task paused: ${task.name}`);
            renderAll();
        }
    }

    function resumeTask(taskId) {
        const task = appState.paused.find(t => t.id === taskId);
        if (task) {
            task.startTime = Date.now() - task.pausedTime;
            task.pausedTime = 0;
            task.status = 'running';
            appState.running.push(task);
            appState.paused = appState.paused.filter(t => t.id !== taskId);
            saveAppState();
            logActivity(`Task resumed: ${task.name}`);
            renderAll();
        }
    }

    function completeTask(taskId, completed) {
        const task = appState.running.find(t => t.id === taskId) || appState.paused.find(t => t.id === taskId);
        if (task) {
            appState.running = appState.running.filter(t => t.id !== taskId);
            appState.paused = appState.paused.filter(t => t.id !== taskId);

            if (completed) {
                appState.tokens += task.reward;
                appState.completed.push(task);
                logActivity(`Task completed: ${task.name} (+${task.reward} tokens)`);
            } else {
                appState.tokens -= task.penalty;
                appState.notcompleted.push(task);
                logActivity(`Task failed: ${task.name} (-${task.penalty} tokens)`);
            }

            saveAppState();
            updateTokenDisplay();
            renderAll();
        }
    }

    function deleteTask(taskId, source) {
        if (confirm('Delete this task?')) {
            appState[source] = appState[source].filter(t => t.id !== taskId);
            saveAppState();
            renderAll();
        }
    }

    function deleteLibraryTask(taskId) {
        if (confirm('Delete this task from library?')) {
            appState.library = appState.library.filter(t => t.id !== taskId);
            saveAppState();
            renderLibrary();
        }
    }

    function startLibraryTask(taskId) {
        const libTask = appState.library.find(t => t.id === taskId);
        if (libTask) {
            const task = {
                id: Date.now(),
                name: libTask.name,
                totalMinutes: libTask.totalMinutes,
                reward: libTask.reward,
                penalty: libTask.penalty,
                startTime: Date.now(),
                pausedTime: 0,
                status: 'running',
                libraryId: taskId
            };

            appState.running.push(task);
            libTask.isRunning = true;
            saveAppState();
            logActivity(`Task started from library: ${libTask.name}`);
            renderLibrary();
            renderRunning();
        }
    }

    // ===================== LIBRARY MANAGEMENT =====================
    function addToLibrary() {
        const name = document.getElementById('libTaskName').value.trim();
        const time = parseInt(document.getElementById('libTaskTime').value);
        const reward = parseInt(document.getElementById('libRewardTokens').value) || 0;
        const penalty = parseInt(document.getElementById('libPenaltyTokens').value) || 0;

        if (!name || !time || time <= 0) {
            alert('Please fill in all fields');
            return;
        }

        const task = {
            id: Date.now(),
            name,
            totalMinutes: time,
            reward,
            penalty
        };

        appState.library.push(task);
        saveAppState();
        logActivity(`Task added to library: ${name}`);

        document.getElementById('libTaskName').value = '';
        document.getElementById('libTaskTime').value = '';
        document.getElementById('libRewardTokens').value = '';
        document.getElementById('libPenaltyTokens').value = '';

        renderLibrary();
    }

    function toggleLibraryControls() {
        appState.showAllLibraryControls = document.getElementById('showAllControls').checked;
        saveAppState();
        renderLibrary();
    }

    function resetLibrary() {
        if (confirm('Reset all library task statuses?')) {
            appState.library.forEach(task => {
                task.isRunning = false;
                task.isPaused = false;
                task.isCompleted = false;
                task.isNotCompleted = false;
            });
            saveAppState();
            renderLibrary();
            logActivity('Library tasks reset');
        }
    }

    // ===================== ACTIVITY LOG =====================
    function logActivity(action) {
        const now = new Date();
        const time = formatPakistaniTime(now);
        appState.activities.unshift(`${time}: ${action}`);
        if (appState.activities.length > ACTIVITY_LIMIT) {
            appState.activities = appState.activities.slice(0, ACTIVITY_LIMIT);
        }
        saveAppState();
    }

    function formatPakistaniTime(date) {
        const options = {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit',
            hour12: true
        };
        return new Intl.DateTimeFormat('en-PK', options).format(date);
    }

    // ===================== TOKEN MANAGEMENT =====================
    function updateTokenDisplay() {
        document.getElementById('tokenCount').textContent = appState.tokens;
    }

    function addManualTokens() {
        const amount = parseInt(document.getElementById('manualTokenInput').value);
        if (isNaN(amount)) {
            alert('Please enter a valid number');
            return;
        }
        appState.tokens += amount;
        saveAppState();
        updateTokenDisplay();
        logActivity(`Manual token adjustment: ${amount > 0 ? '+' : ''}${amount}`);
        document.getElementById('manualTokenInput').value = '';
    }

    function resetTokens() {
        if (confirm('Reset all tokens to 0?')) {
            appState.tokens = 0;
            saveAppState();
            updateTokenDisplay();
            logActivity('Tokens reset to 0');
        }
    }

    // ===================== RESET FUNCTIONS =====================
    function resetRunning() {
        if (confirm('Reset all running tasks?')) {
            appState.running = [];
            saveAppState();
            renderAll();
            logActivity('Running tasks reset');
        }
    }

    function resetPaused() {
        if (confirm('Reset all paused tasks?')) {
            appState.paused = [];
            saveAppState();
            renderAll();
            logActivity('Paused tasks reset');
        }
    }

    function resetCompleted() {
        if (confirm('Reset all completed tasks?')) {
            appState.completed = [];
            saveAppState();
            renderAll();
            logActivity('Completed tasks reset');
        }
    }

    function resetNotCompleted() {
        if (confirm('Reset all not completed tasks?')) {
            appState.notcompleted = [];
            saveAppState();
            renderAll();
            logActivity('Not completed tasks reset');
        }
    }

    function masterReset() {
        if (confirm('MASTER RESET: This will clear EVERYTHING. Are you sure?')) {
            appState = {
                running: [],
                paused: [],
                completed: [],
                notcompleted: [],
                library: [],
                tokens: 0,
                activities: [],
                currentTheme: appState.currentTheme,
                showAllLibraryControls: false,
                pendingCompletion: null
            };
            saveAppState();
            logActivity('MASTER RESET executed');
            renderAll();
            updateTokenDisplay();
        }
    }

    // ===================== COMPLETION POPUP =====================
    function showCompletionPopup(taskId) {
        const task = appState.running.find(t => t.id === taskId);
        if (task) {
            appState.pendingCompletion = taskId;
            document.getElementById('popupTaskName').textContent = task.name;
            document.getElementById('completionPopup').classList.add('active');
        }
    }

    function confirmCompletion(completed) {
        if (appState.pendingCompletion) {
            completeTask(appState.pendingCompletion, completed);
            document.getElementById('completionPopup').classList.remove('active');
            appState.pendingCompletion = null;
        }
    }

    // ===================== RENDERING =====================
    function renderRunning() {
        const container = document.getElementById('runningTasks');
        const empty = document.getElementById('runningEmpty');

        if (appState.running.length === 0) {
            container.innerHTML = '';
            empty.style.display = 'block';
            return;
        }

        empty.style.display = 'none';
        container.innerHTML = appState.running.map(task => {
            const remainingMs = getRemainingMs(task);
            const totalMs = task.totalMinutes * 60 * 1000;
            const progress = Math.max(0, Math.min(100, (1 - remainingMs / totalMs) * 100));
            const isCompleted = remainingMs <= 0;

            return `
                <div class="task-card" style="position: relative;">
                    <div class="fire-effect fire-left">üî•</div>
                    <div class="fire-effect fire-right">üî•</div>
                    <div class="task-name">${task.name}</div>
                    <div class="timer-display">${formatTime(remainingMs)}</div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" style="width: ${progress}%"></div>
                    </div>
                    <div class="task-info">
                        ‚è±Ô∏è ${task.totalMinutes}m
                        ${task.reward > 0 ? `| üíö +${task.reward}` : ''}
                        ${task.penalty > 0 ? `| üíî -${task.penalty}` : ''}
                    </div>
                    <div class="task-controls">
                        <button class="btn btn-warning btn-sm" onclick="pauseTask(${task.id})">‚è∏ Pause</button>
                        <button class="btn btn-success btn-sm" onclick="showCompletionPopup(${task.id})">‚úÖ Done</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteTask(${task.id}, 'running')">üóëÔ∏è</button>
                    </div>
                </div>
            `;
        }).join('');
    }

    function renderPaused() {
        const container = document.getElementById('pausedTasks');
        const empty = document.getElementById('pausedEmpty');

        if (appState.paused.length === 0) {
            container.innerHTML = '';
            empty.style.display = 'block';
            return;
        }

        empty.style.display = 'none';
        container.innerHTML = appState.paused.map(task => {
            const remainingMs = getRemainingMs(task);

            return `
                <div class="task-card">
                    <div class="task-name">${task.name}</div>
                    <div class="timer-display">${formatTime(remainingMs)}</div>
                    <div class="task-info">
                        ‚è±Ô∏è ${task.totalMinutes}m | ‚è∏Ô∏è Paused
                    </div>
                    <div class="task-controls">
                        <button class="btn btn-primary btn-sm" onclick="resumeTask(${task.id})">‚ñ∂Ô∏è Resume</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteTask(${task.id}, 'paused')">üóëÔ∏è</button>
                    </div>
                </div>
            `;
        }).join('');
    }

    function renderCompleted() {
        const container = document.getElementById('completedTasks');
        const empty = document.getElementById('completedEmpty');

        if (appState.completed.length === 0) {
            container.innerHTML = '';
            empty.style.display = 'block';
            return;
        }

        empty.style.display = 'none';
        container.innerHTML = appState.completed.map(task => {
            return `
                <div class="task-card">
                    <div class="task-name">${task.name}</div>
                    <div class="task-info">
                        ‚è±Ô∏è ${task.totalMinutes}m | üíö +${task.reward}
                    </div>
                    <div class="task-controls">
                        <button class="btn btn-danger btn-sm" onclick="deleteTask(${task.id}, 'completed')">üóëÔ∏è</button>
                    </div>
                </div>
            `;
        }).join('');
    }

    function renderNotCompleted() {
        const container = document.getElementById('notcompletedTasks');
        const empty = document.getElementById('notcompletedEmpty');

        if (appState.notcompleted.length === 0) {
            container.innerHTML = '';
            empty.style.display = 'block';
            return;
        }

        empty.style.display = 'none';
        container.innerHTML = appState.notcompleted.map(task => {
            return `
                <div class="task-card">
                    <div class="task-name">${task.name}</div>
                    <div class="task-info">
                        ‚è±Ô∏è ${task.totalMinutes}m | üíî -${task.penalty}
                    </div>
                    <div class="task-controls">
                        <button class="btn btn-danger btn-sm" onclick="deleteTask(${task.id}, 'notcompleted')">üóëÔ∏è</button>
                    </div>
                </div>
            `;
        }).join('');
    }

    function renderLibrary() {
        const container = document.getElementById('libraryTasks');
        const empty = document.getElementById('libraryEmpty');

        if (appState.library.length === 0) {
            container.innerHTML = '';
            empty.style.display = 'block';
            return;
        }

        empty.style.display = 'none';
        container.innerHTML = appState.library.map(task => {
            let status = '';
            let statusClass = '';

            const runningTask = appState.running.find(t => t.libraryId === task.id);
            const pausedTask = appState.paused.find(t => t.libraryId === task.id);
            const completedTask = appState.completed.find(t => t.libraryId === task.id);
            const notCompletedTask = appState.notcompleted.find(t => t.libraryId === task.id);

            if (runningTask) {
                status = 'Running';
                statusClass = 'badge-running';
            } else if (pausedTask) {
                status = 'Paused';
                statusClass = 'badge-paused';
            } else if (completedTask) {
                status = 'Completed';
                statusClass = 'badge-completed';
            } else if (notCompletedTask) {
                status = 'Failed';
                statusClass = 'badge-failed';
            }

            const showStartBtn = !status || appState.showAllLibraryControls;

            return `
                <div class="library-task-item">
                    <div class="library-task-info">
                        <div class="library-task-name">${task.name}</div>
                        <div class="library-task-details">
                            ‚è±Ô∏è ${task.totalMinutes}m | üíö +${task.reward} | üíî -${task.penalty}
                        </div>
                        ${status ? `<div class="task-status-badge ${statusClass}">${status}</div>` : ''}
                    </div>
                    <div class="library-task-buttons">
                        ${showStartBtn ? `<button class="btn btn-primary btn-sm" onclick="startLibraryTask(${task.id})">‚ñ∂Ô∏è Start</button>` : ''}
                        <button class="btn btn-danger btn-sm" onclick="deleteLibraryTask(${task.id})">üóëÔ∏è</button>
                    </div>
                </div>
            `;
        }).join('');
    }

    function renderActivity() {
        const container = document.getElementById('activityLog');
        const empty = document.getElementById('activityEmpty');

        if (appState.activities.length === 0) {
            container.innerHTML = '';
            empty.style.display = 'block';
            return;
        }

        empty.style.display = 'none';
        container.innerHTML = appState.activities.map(activity => {
            return `
                <div class="activity-item">
                    ${activity}
                </div>
            `;
        }).join('');
    }

    function renderAll() {
        renderRunning();
        renderPaused();
        renderCompleted();
        renderNotCompleted();
        renderLibrary();
        renderActivity();
    }

    // ===================== UPDATE LOOP =====================
    function startUpdateLoop() {
        setInterval(() => {
            renderRunning();
            renderPaused();

            appState.running.forEach(task => {
                if (getRemainingMs(task) <= 0 && !task.completionShown) {
                    task.completionShown = true;
                    showCompletionPopup(task.id);
                }
            });
        }, 100);
    }

    // ===================== STARTUP =====================
    window.addEventListener('load', initApp);
</script>
</body>
</html>
